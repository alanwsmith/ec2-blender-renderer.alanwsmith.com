#!/bin/bash

su ubuntu -c 'echo "Prepping scripts" >> /home/ubuntu/setup-log.txt'

TARGET_DIR="/home/ubuntu/reboot-setup"

su ubuntu -c "mkdir $TARGET_DIR"

su ubuntu -c 'crontab -l > /home/ubuntu/crondata'
echo "@reboot /bin/bash /home/ubuntu/setup-director.bash # REBOOTSETUP" >> /home/ubuntu/crondata
su ubuntu -c 'crontab /home/ubuntu/crondata'
rm /home/ubuntu/crondata
echo 'IyEvYmluL2Jhc2gKCkxPR19GSUxFPSIvaG9tZS91YnVudHUvc2V0dXAtbG9nLnR4dCIKVEFSR0VUX0RJUj0iL2hvbWUvdWJ1bnR1L3JlYm9vdC1zZXR1cCIKQUNUSVZFX0ZJTEU9YGxzICRUQVJHRVRfRElSIHwgc29ydCB8IGhlYWQgLTFgCgplY2hvICJJbml0aWFsaXppbmcgU2V0dXAgRGlyZWN0b3IiID4+ICRMT0dfRklMRQoKaWYgWyAteiAkQUNUSVZFX0ZJTEUgXQp0aGVuCiAgICBlY2hvICJObyBtb3JlIGZpbGVzIHRvIHByb2Nlc3MiID4+ICRMT0dfRklMRQogICAgZWNobyAiUmVtb3ZpbmcgZGlyZWN0b3IgcmVtb3ZlZCBmcm9tIGNyb250YWIiID4+ICRMT0dfRklMRQogICAgY3JvbnRhYiAtbCA+IC9ob21lL3VidW50dS9jcm9uZGF0YQogICAgc2VkIC1pICcvUkVCT09UU0VUVVAvZCcgL2hvbWUvdWJ1bnR1L2Nyb25kYXRhCiAgICBjcm9udGFiIC9ob21lL3VidW50dS9jcm9uZGF0YQogICAgcm0gL2hvbWUvdWJ1bnR1L2Nyb25kYXRhCiAgICBlY2hvICJSZW1vdmluZyAkVEFSR0VUX0RJUiIgPj4gJExPR19GSUxFCiAgICBybWRpciAkVEFSR0VUX0RJUgogICAgZWNobyAiUmVtb3Zpbmcgc2V0dXAtZGlyZWN0b3IuYmFzaCIgPj4gJExPR19GSUxFCiAgICBybSAnL2hvbWUvdWJ1bnR1L3NldHVwLWRpcmVjdG9yLmJhc2gnCiAgICBzaHV0ZG93bgplbHNlCiAgQUNUSVZFX0ZJTEVfUEFUSD0iJFRBUkdFVF9ESVIvJEFDVElWRV9GSUxFIgogIGVjaG8gIlJ1bm5pbmc6ICR7QUNUSVZFX0ZJTEVfUEFUSH0iID4+ICRMT0dfRklMRQogIC9iaW4vYmFzaCAkQUNUSVZFX0ZJTEVfUEFUSAogIGVjaG8gIkRlbGV0aW5nOiAke0FDVElWRV9GSUxFX1BBVEh9IiA+PiAkTE9HX0ZJTEUKICBybSAkQUNUSVZFX0ZJTEVfUEFUSAogIGVjaG8gIlJlYm9vdGluZyBmcm9tIHNldHVwLWRpcmVjdG9yIiA+PiAkTE9HX0ZJTEUKICBzdWRvIHJlYm9vdCAKZmkgICAgICAgICAgIAoK' | base64 -d > /home/ubuntu/setup-director.bash
echo 'IyEvYmluL2Jhc2gKCkxPR0ZJTEU9Ii9ob21lL3VidW50dS9zZXR1cC1sb2cudHh0IgplY2hvICJNYWtpbmcgL3J1bi91c2VyLzEwMDAvZ3ZmcyIgPj4gJExPR0ZJTEUKbWtkaXIgLXAgL3J1bi91c2VyLzEwMDAvZ3ZmcwpjaG1vZCB1Zyt3IC9ydW4vdXNlci8xMDAwL2d2ZnMKZWNobyAic3VkbyBhcHQgLXkgdXBkYXRlIiA+PiAkTE9HRklMRQpzdWRvIGFwdCAteSB1cGRhdGUKZWNobyAic3VkbyBhcHQgLXkgdXBncmFkZSIgPj4gJExPR0ZJTEUKc3VkbyBhcHQgLXkgdXBncmFkZQo=' | base64 -d > /home/ubuntu/reboot-setup/01-reboot.bash
echo 'IyEvYmluL2Jhc2gKCkxPR0ZJTEU9Ii9ob21lL3VidW50dS9zZXR1cC1sb2cudHh0IgplY2hvICJzdWRvIGFwdCAteSB1cGRhdGUiID4+ICRMT0dGSUxFCnN1ZG8gYXB0IC15IHVwZGF0ZQplY2hvICJNYWtpbmcgdGVzdCBmaWxlcyBkaXJlY3RvcnkiID4+ICRMT0dGSUxFCm1rZGlyIC1wIC9ob21lL3VidW50dS9ibGVuZGVyX3Byb2ZpbGVyL3Rlc3RfZmlsZXMKZWNobyAiSW5zdGFsbGluZyBBV1MgQ0xJIiA+PiAkTE9HRklMRQpzdWRvIHNuYXAgaW5zdGFsbCBhd3MtY2xpIC0tY2xhc3NpYwplY2hvICJHZXR0aW5nIGZpbGVzIGZyb20gUzMiID4+ICRMT0dGSUxFCmF3cyBzMyBjcCBzMzovL2F3cy10bXAtYmxlbmRlci10ZXN0LWZpbGVzL2ZsYXQtYXJjaGl2aXouYmxlbmQgL2hvbWUvdWJ1bnR1L2JsZW5kZXJfcHJvZmlsZXIvdGVzdF9maWxlcwphd3MgczMgY3AgczM6Ly9hd3MtdG1wLWJsZW5kZXItdGVzdC1maWxlcy9sb2Z0LmJsZW5kIC9ob21lL3VidW50dS9ibGVuZGVyX3Byb2ZpbGVyL3Rlc3RfZmlsZXMKYXdzIHMzIGNwIHMzOi8vYXdzLXRtcC1ibGVuZGVyLXRlc3QtZmlsZXMvbG9uZS1tb25rX2N5Y2xlc19hbmRfZXhwb3N1cmUtbm9kZV9kZW1vLmJsZW5kIC9ob21lL3VidW50dS9ibGVuZGVyX3Byb2ZpbGVyL3Rlc3RfZmlsZXMKYXdzIHMzIGNwIHMzOi8vYXdzLXRtcC1ibGVuZGVyLXRlc3QtZmlsZXMvbW9uc3Rlcl91bmRlcl90aGVfYmVkX3Nzc19kZW1vX2J5X21ldGluX3NldmVuLmJsZW5kIC9ob21lL3VidW50dS9ibGVuZGVyX3Byb2ZpbGVyL3Rlc3RfZmlsZXMKZWNobyAiSW5zdGFsbGluZyBCbGVuZGVyIGRlcGVuZGljaWVzIiA+PiAkTE9HRklMRQpzdWRvIGFwdCAteSBpbnN0YWxsIGxpYnhpNgpzdWRvIGFwdCAteSBpbnN0YWxsIGxpYnh4Zjg2dm0tZGV2CnN1ZG8gYXB0IC15IGluc3RhbGwgbGlieGZpeGVzLWRldgpzdWRvIGFwdCAteSBpbnN0YWxsIGxpYnhyZW5kZXItZGV2CnN1ZG8gYXB0IC15IGluc3RhbGwgbGliZ2wtZGV2Cg==' | base64 -d > /home/ubuntu/reboot-setup/02-reboot.bash
echo 'IyEvYmluL2Jhc2gKCkxPR0ZJTEU9Ii9ob21lL3VidW50dS9zZXR1cC1sb2cudHh0IgplY2hvICJzdWRvIGFwdCAteSBpbnN0YWxsIG52aWRpYS1oZWFkbGVzcy01MTUtc2VydmVyIiA+PiAkTE9HRklMRQpzdWRvIGFwdCAteSBpbnN0YWxsIG52aWRpYS1oZWFkbGVzcy01MTUtc2VydmVyCgo=' | base64 -d > /home/ubuntu/reboot-setup/03-reboot.bash
echo 'IyEvYmluL2Jhc2gKCkxPR0ZJTEU9Ii9ob21lL3VidW50dS9zZXR1cC1sb2cudHh0IgplY2hvICJHZXR0aW5nIGN1ZGEta2V5cmluZ18xLjAtMV9hbGwuZGViIiA+PiAkTE9HRklMRQp3Z2V0IGh0dHBzOi8vZGV2ZWxvcGVyLmRvd25sb2FkLm52aWRpYS5jb20vY29tcHV0ZS9jdWRhL3JlcG9zL3VidW50dTIwMDQveDg2XzY0L2N1ZGEta2V5cmluZ18xLjAtMV9hbGwuZGViCnN1ZG8gZHBrZyAtaSBjdWRhLWtleXJpbmdfMS4wLTFfYWxsLmRlYgpzdWRvIGFwdC1rZXkgZGVsIDdmYTJhZjgwCnN1ZG8gYXB0LWdldCB1cGRhdGUKZWNobyAic3VkbyBhcHQtZ2V0IC15IGluc3RhbGwgY3VkYSIgPj4gJExPR0ZJTEUKc3VkbyBhcHQgLXkgaW5zdGFsbCBjdWRhCmVjaG8gJ2V4cG9ydCBQQVRIPS91c3IvbG9jYWwvY3VkYS0xMS44L2JpbiR7UEFUSDorOiR7UEFUSH19JyA+PiAvaG9tZS91YnVudHUvLmJhc2hyYwpzdWRvIGNwIC9saWIvdWRldi9ydWxlcy5kLzQwLXZtLWhvdGFkZC5ydWxlcyAvZXRjL3VkZXYvcnVsZXMuZApzdWRvIHNlZCAtaSAnLyMgTWVtb3J5IGhvdGFkZCByZXF1ZXN0L2QnIC9ldGMvdWRldi9ydWxlcy5kLzQwLXZtLWhvdGFkZC5ydWxlcwpzdWRvIHNlZCAtaSAnL1NVQlNZU1RFTT09Im1lbW9yeSIsIEFDVElPTj09ImFkZCIvZCcgL2V0Yy91ZGV2L3J1bGVzLmQvNDAtdm0taG90YWRkLnJ1bGVzCg==' | base64 -d > /home/ubuntu/reboot-setup/04-reboot.bash
echo '' | base64 -d > /home/ubuntu/reboot-setup/reboot-05.bash
reboot
