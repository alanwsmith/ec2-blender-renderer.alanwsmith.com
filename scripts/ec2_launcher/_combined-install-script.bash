#!/bin/bash

su ubuntu -c 'echo "Prepping scripts" >> /home/ubuntu/setup-log.txt'

TARGET_DIR="/home/ubuntu/reboot-setup"

su ubuntu -c "mkdir $TARGET_DIR"

su ubuntu -c 'crontab -l > /home/ubuntu/crondata'
echo "@reboot /bin/bash /home/ubuntu/setup-director.bash # REBOOTSETUP" >> /home/ubuntu/crondata
su ubuntu -c 'crontab /home/ubuntu/crondata'
rm /home/ubuntu/crondata
echo 'IyEvYmluL2Jhc2gKCkxPR19GSUxFPSIvaG9tZS91YnVudHUvc2V0dXAtbG9nLnR4dCIKVEFSR0VUX0RJUj0iL2hvbWUvdWJ1bnR1L3JlYm9vdC1zZXR1cCIKQUNUSVZFX0ZJTEU9YGxzICRUQVJHRVRfRElSIHwgc29ydCB8IGhlYWQgLTFgCgplY2hvICJTdGFydGluZyB1cCIgPj4gJExPR19GSUxFCgppZiBbIC16ICRBQ1RJVkVfRklMRSBdCnRoZW4KICAgIGVjaG8gIk5vIG1vcmUgZmlsZXMgdG8gcHJvY2VzcyIgPj4gJExPR19GSUxFCiAgICBlY2hvICJSZW1vdmluZyBkaXJlY3RvciByZW1vdmVkIGZyb20gY3JvbnRhYiIgPj4gJExPR19GSUxFCiAgICBjcm9udGFiIC1sID4gL2hvbWUvdWJ1bnR1L2Nyb25kYXRhCiAgICBzZWQgLWkgJy9SRUJPT1RTRVRVUC9kJyAvaG9tZS91YnVudHUvY3JvbmRhdGEKICAgIGNyb250YWIgL2hvbWUvdWJ1bnR1L2Nyb25kYXRhCiAgICBybSAvaG9tZS91YnVudHUvY3JvbmRhdGEKICAgIGVjaG8gIlJlbW92aW5nICRUQVJHRVRfRElSIiA+PiAkTE9HX0ZJTEUKICAgIHJtZGlyICRUQVJHRVRfRElSCiAgICBlY2hvICJSZW1vdmluZyBzZXR1cC1kaXJlY3Rvci5iYXNoIiA+PiAkTE9HX0ZJTEUKICAgIHJtICcvaG9tZS91YnVudHUvc2V0dXAtZGlyZWN0b3IuYmFzaCcKICAgIHNodXRkb3duCmVsc2UKICBBQ1RJVkVfRklMRV9QQVRIPSIkVEFSR0VUX0RJUi8kQUNUSVZFX0ZJTEUiCiAgZWNobyAiUnVubmluZzogJHtBQ1RJVkVfRklMRV9QQVRIfSIgPj4gJExPR19GSUxFCiAgL2Jpbi9iYXNoICRBQ1RJVkVfRklMRV9QQVRICiAgZWNobyAiRGVsZXRpbmc6ICR7QUNUSVZFX0ZJTEVfUEFUSH0iID4+ICRMT0dfRklMRQogIHJtICRBQ1RJVkVfRklMRV9QQVRICiAgZWNobyAiUmVib290aW5nIGZyb20gc2V0dXAtZGlyZWN0b3IiID4+ICRMT0dfRklMRQogIHN1ZG8gcmVib290IApmaSAgICAgICAgICAgCgo=' | base64 -d > /home/ubuntu/setup-director.bash
echo 'IyEvYmluL2Jhc2gKCkxPR0ZJTEU9Ii9ob21lL3VidW50dS9zZXR1cC1sb2cudHh0IgplY2hvICJNYWtpbmcgL3J1bi91c2VyLzEwMDAvZ3ZmcyIgPj4gJExPR0ZJTEUKbWtkaXIgLXAgL3J1bi91c2VyLzEwMDAvZ3ZmcwpjaG1vZCB1Zyt3IC9ydW4vdXNlci8xMDAwL2d2ZnMKZWNobyAic3VkbyBhcHQgLXkgdXBkYXRlIiA+PiAkTE9HRklMRQpzdWRvIGFwdCAteSB1cGRhdGUKZWNobyAic3VkbyBhcHQgLXkgdXBncmFkZSIgPj4gJExPR0ZJTEUKc3VkbyBhcHQgLXkgdXBncmFkZQo=' | base64 -d > /home/ubuntu/reboot-setup/01-reboot.bash
echo 'IyEvYmluL2Jhc2gKCkxPR0ZJTEU9Ii9ob21lL3VidW50dS9zZXR1cC1sb2cudHh0IgplY2hvICJzdWRvIGFwdCAteSB1cGRhdGUiID4+ICRMT0dGSUxFCnN1ZG8gYXB0IC15IHVwZGF0ZQplY2hvICJNYWtpbmcgdGVzdCBmaWxlcyBkaXJlY3RvcnkiID4+ICRMT0dGSUxFCm1rZGlyIC1wIC9ob21lL3VidW50dS9ibGVuZGVyX3Byb2ZpbGVyL3Rlc3RfZmlsZXMKZWNobyAiSW5zdGFsbGluZyBBV1MgQ0xJIiA+PiAkTE9HRklMRQpzdWRvIHNuYXAgaW5zdGFsbCBhd3MtY2xpIC0tY2xhc3NpYwplY2hvICJHZXR0aW5nIGZpbGVzIGZyb20gUzMiID4+ICRMT0dGSUxFCmF3cyBzMyBjcCBzMzovL2F3cy10bXAtYmxlbmRlci10ZXN0LWZpbGVzL2ZsYXQtYXJjaGl2aXouYmxlbmQgL2hvbWUvdWJ1bnR1L2JsZW5kZXJfcHJvZmlsZXIvdGVzdF9maWxlcwphd3MgczMgY3AgczM6Ly9hd3MtdG1wLWJsZW5kZXItdGVzdC1maWxlcy9sb2Z0LmJsZW5kIC9ob21lL3VidW50dS9ibGVuZGVyX3Byb2ZpbGVyL3Rlc3RfZmlsZXMKYXdzIHMzIGNwIHMzOi8vYXdzLXRtcC1ibGVuZGVyLXRlc3QtZmlsZXMvbG9uZS1tb25rX2N5Y2xlc19hbmRfZXhwb3N1cmUtbm9kZV9kZW1vLmJsZW5kIC9ob21lL3VidW50dS9ibGVuZGVyX3Byb2ZpbGVyL3Rlc3RfZmlsZXMKYXdzIHMzIGNwIHMzOi8vYXdzLXRtcC1ibGVuZGVyLXRlc3QtZmlsZXMvbW9uc3Rlcl91bmRlcl90aGVfYmVkX3Nzc19kZW1vX2J5X21ldGluX3NldmVuLmJsZW5kIC9ob21lL3VidW50dS9ibGVuZGVyX3Byb2ZpbGVyL3Rlc3RfZmlsZXMKZWNobyAiSW5zdGFsbGluZyBCbGVuZGVyIGRlcGVuZGljaWVzIiA+PiAkTE9HRklMRQpzdWRvIGFwdCAteSBpbnN0YWxsIGxpYnhpNgpzdWRvIGFwdCAteSBpbnN0YWxsIGxpYnh4Zjg2dm0tZGV2CnN1ZG8gYXB0IC15IGluc3RhbGwgbGlieGZpeGVzLWRldgpzdWRvIGFwdCAteSBpbnN0YWxsIGxpYnhyZW5kZXItZGV2CnN1ZG8gYXB0IC15IGluc3RhbGwgbGliZ2wtZGV2Cgo=' | base64 -d > /home/ubuntu/reboot-setup/02-reboot.bash
echo 'IyEvYmluL2Jhc2gKCkxPR0ZJTEU9Ii9ob21lL3VidW50dS9zZXR1cC1sb2cudHh0IgplY2hvICJzdWRvIGFwdCAteSBpbnN0YWxsIG52aWRpYS1oZWFkbGVzcy01MTUtc2VydmVyIiA+PiAkTE9HRklMRQpzdWRvIGFwdCAteSBpbnN0YWxsIG52aWRpYS1oZWFkbGVzcy01MTUtc2VydmVyCgo=' | base64 -d > /home/ubuntu/reboot-setup/03-reboot.bash
reboot
