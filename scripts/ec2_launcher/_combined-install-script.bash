#!/bin/bash

su ubuntu -c 'echo "Prepping scripts" >> /home/ubuntu/setup-log.txt'

TARGET_DIR="/home/ubuntu/reboot-setup"

su ubuntu -c "mkdir $TARGET_DIR"

su ubuntu -c 'crontab -l > /home/ubuntu/crondata'
echo "@reboot /bin/bash /home/ubuntu/reboot-setup-director.bash # REBOOTSETUP" >> /home/ubuntu/crondata
su ubuntu -c 'crontab /home/ubuntu/crondata'
rm /home/ubuntu/crondata
echo 'IyEvYmluL2Jhc2gKCkxPR19GSUxFPSIvaG9tZS91YnVudHUvc2V0dXAtbG9nLnR4dCIKVEFSR0VUX0RJUj0iL2hvbWUvdWJ1bnR1L3JlYm9vdC1zZXR1cCIKQUNUSVZFX0ZJTEU9YGxzICRUQVJHRVRfRElSIHwgc29ydCB8IGhlYWQgLTFgCgplY2hvICJTdGFydGluZyB1cCIgPj4gJExPR19GSUxFCgppZiBbIC16ICRBQ1RJVkVfRklMRSBdCnRoZW4KICAgIGVjaG8gIk5vIG1vcmUgZmlsZXMgdG8gcHJvY2VzcyIgPj4gJExPR19GSUxFCiAgICBlY2hvICJSZW1vdmluZyBkaXJlY3RvciByZW1vdmVkIGZyb20gY3JvbnRhYiIgPj4gJExPR19GSUxFCiAgICBjcm9udGFiIC1sID4gL2hvbWUvdWJ1bnR1L2Nyb25kYXRhCiAgICBzZWQgLWkgJy9SRUJPT1RTRVRVUC9kJyAvaG9tZS91YnVudHUvY3JvbmRhdGEKICAgIGNyb250YWIgL2hvbWUvdWJ1bnR1L2Nyb25kYXRhCiAgICBybSAvaG9tZS91YnVudHUvY3JvbmRhdGEKICAgIGVjaG8gIlJlbW92aW5nICRUQVJHRVRfRElSIiA+PiAkTE9HX0ZJTEUKICAgIHJtZGlyICRUQVJHRVRfRElSCiAgICBlY2hvICJSZW1vdmluZyByZWJvb3Qtc2V0dXAtZGlyZWN0b3IuYmFzaCIgPj4gJExPR19GSUxFCiAgICBybSAnL2hvbWUvdWJ1bnR1L3JlYm9vdC1zZXR1cC1kaXJlY3Rvci5iYXNoJwogICAgc2h1dGRvd24KZWxzZQogIEFDVElWRV9GSUxFX1BBVEg9IiRUQVJHRVRfRElSLyRBQ1RJVkVfRklMRSIKICBlY2hvICJSdW5uaW5nOiAke0FDVElWRV9GSUxFX1BBVEh9IiA+PiAkTE9HX0ZJTEUKICAvYmluL2Jhc2ggJEFDVElWRV9GSUxFX1BBVEgKICBlY2hvICJSZW1vdmluZzogJHtBQ1RJVkVfRklMRV9QQVRIfSIgPj4gJExPR19GSUxFCiAgcm0gJEFDVElWRV9GSUxFX1BBVEgKICBlY2hvICJSZWJvb3RpbmcgZnJvbSByZWJvb3Qtc2V0dXAtZGlyZWN0b3IiID4+ICRMT0dfRklMRQogIHN1ZG8gcmVib290IApmaSAgICAgICAgICAgCgo=' | base64 -d > /home/ubuntu/reboot-setup-director.bash
echo 'IyEvYmluL2Jhc2gKCkxPR0ZJTEU9Ii9ob21lL3VidW50dS9zZXR1cC1sb2cudHh0IgoKZWNobyAiU3RhcnRpbmcgc2NyaXB0IDAxIiA+PiAkTE9HRklMRQpzdWRvIGFwdCAteSB1cGRhdGUKc3VkbyBhcHQgLXkgdXBncmFkZQplY2hvICJDb21wbGV0ZWQgdXBkYXRlIGFuZCB1cGdhdGUiID4+ICRMT0dGSUxFCgojIAoK' | base64 -d > /home/ubuntu/reboot-setup/reboot-01.bash
echo 'IyEvYmluL2Jhc2gKCkxPR0ZJTEU9Ii9ob21lL3VidW50dS9zZXR1cC1sb2cudHh0IgoKZWNobyAiU3RhcnRpbmcgc2NyaXB0IDAyIiA+PiAkTE9HRklMRQplY2hvICJJbnN0YWxsaW5nOiBudmlkaWEtaGVhZGxlc3MtNTE1LXNlcnZlciIgPj4gJExPR0ZJTEUKc3VkbyBhcHQgLXkgaW5zdGFsbCBudmlkaWEtaGVhZGxlc3MtNTE1LXNlcnZlcgplY2hvICJGaW5pc2hlZCBzY3JpcHQgMDIiID4+ICRMT0dGSUxFCgoK' | base64 -d > /home/ubuntu/reboot-setup/reboot-02.bash
echo 'IyEvYmluL2Jhc2gKCkxPR0ZJTEU9Ii9ob21lL3VidW50dS9zZXR1cC1sb2cudHh0IgoKZWNobyAiU3RhcnRpbmcgc2NyaXB0IDAzIiA+PiAkTE9HRklMRQplY2hvICJJbnN0YWxsaW5nOiBudmlkaWEtY3VkYS10b29sa2l0IiA+PiAkTE9HRklMRQpzdWRvIGFwdCAteSBpbnN0YWxsIG52aWRpYS1jdWRhLXRvb2xraXQKZWNobyAiRmluaXNoZWQgc2NyaXB0IDAzIiA+PiAkTE9HRklMRQoKCg==' | base64 -d > /home/ubuntu/reboot-setup/reboot-03.bash
echo 'IyEvYmluL2Jhc2gKCkxPR0ZJTEU9Ii9ob21lL3VidW50dS9zZXR1cC1sb2cudHh0IgoKZWNobyAiU3RhcnRpbmcgc2NyaXB0IDA0IiA+PiAkTE9HRklMRQpzdWRvIGFwdC11cGRhdGUgCnN1ZG8gc25hcCBpbnN0YWxsIGF3cy1jbGkgLS1jbGFzc2ljCmF3cyAtLXJlZ2lvbiB1cy1lYXN0LTEgc2VjcmV0c21hbmFnZXIgZ2V0LXNlY3JldC12YWx1ZSAtLXNlY3JldC1pZCBFQzJfS2V5X0Zvcl9HaXRIdWIgLS1xdWVyeSBTZWNyZXRTdHJpbmcgLS1vdXRwdXQgdGV4dCA+IH4vLnNzaC9pZF9lZDI1NTE5CmNobW9kIDQwMCB+Ly5zc2gvaWRfZWQyNTUxOQpldmFsICIkKHNzaC1hZ2VudCAtcykiICYmIHNzaC1hZGQgfi8uc3NoL2lkX2VkMjU1MTkKZWNobyAiZ2l0aHViLmNvbSwxNDAuODIuMTE0LjMgZWNkc2Etc2hhMi1uaXN0cDI1NiBBQUFBRTJWalpITmhMWE5vWVRJdGJtbHpkSEF5TlRZQUFBQUlibWx6ZEhBeU5UWUFBQUJCQkVtS1NFTmpRRWV6T214a1pNeTdvcEtnd0ZCOW5rdDVZUnJZTWpOdUc1Tjg3dVJnZzZDTHJibzV3QWRUL3k2djBtS1YwVTJ3MFdaMllCLysrVHBvY2tnPSIgPj4gfi8uc3NoL2tub3duX2hvc3RzCm1rZGlyIC1wIC9ydW4vdXNlci8xMDAwL2d2ZnMKc3VkbyBzbmFwIGluc3RhbGwgYmxlbmRlciAtLWNsYXNzaWMKZ2l0IGNsb25lIGdpdEBnaXRodWIuY29tOmFsYW53c21pdGgvZWMyLWJsZW5kZXItcmVuZGVyZXIuYWxhbndzbWl0aC5jb20uZ2l0CnN1ZG8gYXB0IC15IGluc3RhbGwgcHl0aG9uMy1waXAKcGlwMyBpbnN0YWxsIHJlcXVlc3RzCmVjaG8gIkZpbmlzaGVkIHNjcmlwdCAwNCIgPj4gJExPR0ZJTEUKCgo=' | base64 -d > /home/ubuntu/reboot-setup/reboot-04.bash
echo 'IyEvYmluL2Jhc2gKCkxPR0ZJTEU9Ii9ob21lL3VidW50dS9zZXR1cC1sb2cudHh0IgoKZWNobyAiU3RhcnRpbmcgc2NyaXB0IDA1IiA+PiAkTE9HRklMRQplY2hvICJTdGFydGluZyBSdW4iID4+ICRMT0dGSUxFCmNkIH4vZWMyLWJsZW5kZXItcmVuZGVyZXIuYWxhbndzbWl0aC5jb20vc2NyaXB0cy9wcm9maWxlX21hY2hpbmUKcHl0aG9uMyBwcm9maWxlX21hY2hpbmUucHkKZWNobyAiVE9ETzogMDUtIHB1dCBpbiBwcm9maWxlIHJ1biBoZXJlIiA+PiAkTE9HRklMRQplY2hvICJGaW5pc2hlZCBzY3JpcHQgMDUiID4+ICRMT0dGSUxFCgoK' | base64 -d > /home/ubuntu/reboot-setup/reboot-05.bash
reboot
