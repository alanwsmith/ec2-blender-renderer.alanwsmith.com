#!/bin/bash

su ubuntu -c 'echo "Prepping scripts" >> /home/ubuntu/setup-log.txt'

TARGET_DIR="/home/ubuntu/reboot-setup"

su ubuntu -c "mkdir $TARGET_DIR"

su ubuntu -c 'crontab -l > /home/ubuntu/crondata'
echo "@reboot /bin/bash /home/ubuntu/setup-director.bash # REBOOTSETUP" >> /home/ubuntu/crondata
su ubuntu -c 'crontab /home/ubuntu/crondata'
rm /home/ubuntu/crondata
echo 'IyEvYmluL2Jhc2gKCkxPR19GSUxFPSIvaG9tZS91YnVudHUvc2V0dXAtbG9nLnR4dCIKVEFSR0VUX0RJUj0iL2hvbWUvdWJ1bnR1L3JlYm9vdC1zZXR1cCIKQUNUSVZFX0ZJTEU9YGxzICRUQVJHRVRfRElSIHwgc29ydCB8IGhlYWQgLTFgCgplY2hvICIkKGRhdGUpIC0gSW5pdGlhbGl6aW5nIFNldHVwIERpcmVjdG9yIiA+PiAkTE9HX0ZJTEUKCmlmIFsgLXogJEFDVElWRV9GSUxFIF0KdGhlbgogICAgZWNobyAiJChkYXRlKSAtIE5vIG1vcmUgZmlsZXMgdG8gcHJvY2VzcyIgPj4gJExPR19GSUxFCiAgICBlY2hvICIkKGRhdGUpIC0gUmVtb3ZpbmcgZGlyZWN0b3IgcmVtb3ZlZCBmcm9tIGNyb250YWIiID4+ICRMT0dfRklMRQogICAgY3JvbnRhYiAtbCA+IC9ob21lL3VidW50dS9jcm9uZGF0YQogICAgc2VkIC1pICcvUkVCT09UU0VUVVAvZCcgL2hvbWUvdWJ1bnR1L2Nyb25kYXRhCiAgICBjcm9udGFiIC9ob21lL3VidW50dS9jcm9uZGF0YQogICAgcm0gL2hvbWUvdWJ1bnR1L2Nyb25kYXRhCiAgICBlY2hvICIkKGRhdGUpIC0gUmVtb3ZpbmcgJFRBUkdFVF9ESVIiID4+ICRMT0dfRklMRQogICAgcm1kaXIgJFRBUkdFVF9ESVIKICAgIGVjaG8gIiQoZGF0ZSkgLSBSZW1vdmluZyBzZXR1cC1kaXJlY3Rvci5iYXNoIiA+PiAkTE9HX0ZJTEUKICAgIHJtICcvaG9tZS91YnVudHUvc2V0dXAtZGlyZWN0b3IuYmFzaCcKICAgIGVjaG8gIiQoZGF0ZSkgLSBTaHV0dGluZyBkb3duIiA+PiAkTE9HX0ZJTEUKICAgIHN1ZG8gc2h1dGRvd24KZWxzZQogIEFDVElWRV9GSUxFX1BBVEg9IiRUQVJHRVRfRElSLyRBQ1RJVkVfRklMRSIKICBlY2hvICIkKGRhdGUpIC0gUnVubmluZzogJHtBQ1RJVkVfRklMRV9QQVRIfSIgPj4gJExPR19GSUxFCiAgL2Jpbi9iYXNoICRBQ1RJVkVfRklMRV9QQVRICiAgZWNobyAiJChkYXRlKSAtIERlbGV0aW5nOiAke0FDVElWRV9GSUxFX1BBVEh9IiA+PiAkTE9HX0ZJTEUKICBybSAkQUNUSVZFX0ZJTEVfUEFUSAogIGVjaG8gIiQoZGF0ZSkgLSBSZWJvb3RpbmcgZnJvbSBzZXR1cC1kaXJlY3RvciIgPj4gJExPR19GSUxFCiAgc3VkbyByZWJvb3QgCmZpICAgICAgICAgICAK' | base64 -d > /home/ubuntu/setup-director.bash
echo 'IyEvYmluL2Jhc2gKCkxPR0ZJTEU9Ii9ob21lL3VidW50dS9zZXR1cC1sb2cudHh0IgplY2hvICJNYWtpbmcgL3J1bi91c2VyLzEwMDAvZ3ZmcyIgPj4gJExPR0ZJTEUKbWtkaXIgLXAgL3J1bi91c2VyLzEwMDAvZ3ZmcwpjaG1vZCB1Zyt3IC9ydW4vdXNlci8xMDAwL2d2ZnMKZWNobyAic3VkbyBhcHQgLXkgdXBkYXRlIiA+PiAkTE9HRklMRQpzdWRvIGFwdCAteSB1cGRhdGUKZWNobyAic3VkbyBhcHQgLXkgdXBncmFkZSIgPj4gJExPR0ZJTEUKc3VkbyBhcHQgLXkgdXBncmFkZQoK' | base64 -d > /home/ubuntu/reboot-setup/01-reboot.bash
echo 'IyEvYmluL2Jhc2gKCkxPR0ZJTEU9Ii9ob21lL3VidW50dS9zZXR1cC1sb2cudHh0IgplY2hvICJzdWRvIGFwdCAteSB1cGRhdGUiID4+ICRMT0dGSUxFCnN1ZG8gYXB0IC15IHVwZGF0ZQplY2hvICJNYWtpbmcgdGVzdCBmaWxlcyBkaXJlY3RvcnkiID4+ICRMT0dGSUxFCm1rZGlyIC1wIC9ob21lL3VidW50dS9ibGVuZGVyX3Byb2ZpbGVyL3Rlc3RfZmlsZXMKZWNobyAiSW5zdGFsbGluZyBBV1MgQ0xJIiA+PiAkTE9HRklMRQpzdWRvIHNuYXAgaW5zdGFsbCBhd3MtY2xpIC0tY2xhc3NpYwoKCmVjaG8gIkluc3RhbGxpbmcgQmxlbmRlciBkZXBlbmRpY2llcyIgPj4gJExPR0ZJTEUKc3VkbyBhcHQgLXkgaW5zdGFsbCBsaWJ4aTYKc3VkbyBhcHQgLXkgaW5zdGFsbCBsaWJ4eGY4NnZtLWRldgpzdWRvIGFwdCAteSBpbnN0YWxsIGxpYnhmaXhlcy1kZXYKc3VkbyBhcHQgLXkgaW5zdGFsbCBsaWJ4cmVuZGVyLWRldgpzdWRvIGFwdCAteSBpbnN0YWxsIGxpYmdsLWRldgo=' | base64 -d > /home/ubuntu/reboot-setup/02-reboot.bash
echo 'IyEvYmluL2Jhc2gKCkxPR0ZJTEU9Ii9ob21lL3VidW50dS9zZXR1cC1sb2cudHh0IgoKZWNobyAiJChkYXRlKSAtIEdldHRpbmcgZmlsZXMgZnJvbSBTMyIgPj4gJExPR0ZJTEUKL3NuYXAvYmluL2F3cyBzMyBjcCAiczM6Ly9hd3MtdG1wLWJsZW5kZXItdGVzdC1maWxlcy9mbGF0LWFyY2hpdml6LmJsZW5kIiAiL2hvbWUvdWJ1bnR1L2JsZW5kZXJfcHJvZmlsZXIvdGVzdF9maWxlcy9mbGF0LWFyY2hpdml6LmJsZW5kIgovc25hcC9iaW4vYXdzIHMzIGNwICJzMzovL2F3cy10bXAtYmxlbmRlci10ZXN0LWZpbGVzL2xvZnQuYmxlbmQiICIvaG9tZS91YnVudHUvYmxlbmRlcl9wcm9maWxlci90ZXN0X2ZpbGVzL2xvZnQuYmxlbmQiCi9zbmFwL2Jpbi9hd3MgczMgY3AgInMzOi8vYXdzLXRtcC1ibGVuZGVyLXRlc3QtZmlsZXMvbG9uZS1tb25rX2N5Y2xlc19hbmRfZXhwb3N1cmUtbm9kZV9kZW1vLmJsZW5kIiAiL2hvbWUvdWJ1bnR1L2JsZW5kZXJfcHJvZmlsZXIvdGVzdF9maWxlcy9sb25lLW1vbmtfY3ljbGVzX2FuZF9leHBvc3VyZS1ub2RlX2RlbW8uYmxlbmQiCi9zbmFwL2Jpbi9hd3MgczMgY3AgInMzOi8vYXdzLXRtcC1ibGVuZGVyLXRlc3QtZmlsZXMvbW9uc3Rlcl91bmRlcl90aGVfYmVkX3Nzc19kZW1vX2J5X21ldGluX3NldmVuLmJsZW5kIiAiL2hvbWUvdWJ1bnR1L2JsZW5kZXJfcHJvZmlsZXIvdGVzdF9maWxlcy9tb25zdGVyX3VuZGVyX3RoZV9iZWRfc3NzX2RlbW9fYnlfbWV0aW5fc2V2ZW4uYmxlbmQiCgplY2hvICIkKGRhdGUpIC0gR2V0dGluZyBnaXQga2V5IiA+PiAkTE9HRklMRQovc25hcC9iaW4vYXdzIC0tcmVnaW9uIHVzLWVhc3QtMSBzZWNyZXRzbWFuYWdlciBnZXQtc2VjcmV0LXZhbHVlIC0tc2VjcmV0LWlkIEVDMl9LZXlfRm9yX0dpdEh1YiAtLXF1ZXJ5IFNlY3JldFN0cmluZyAtLW91dHB1dCB0ZXh0ID4gfi8uc3NoL2lkX2VkMjU1MTkKY2htb2QgNDAwIH4vLnNzaC9pZF9lZDI1NTE5CmV2YWwgIiQoc3NoLWFnZW50IC1zKSIgJiYgc3NoLWFkZCB+Ly5zc2gvaWRfZWQyNTUxOQplY2hvICJnaXRodWIuY29tLDE0MC44Mi4xMTQuMyBlY2RzYS1zaGEyLW5pc3RwMjU2IEFBQUFFMlZqWkhOaExYTm9ZVEl0Ym1semRIQXlOVFlBQUFBSWJtbHpkSEF5TlRZQUFBQkJCRW1LU0VOalFFZXpPbXhrWk15N29wS2d3RkI5bmt0NVlScllNak51RzVOODd1UmdnNkNMcmJvNXdBZFQveTZ2MG1LVjBVMncwV1oyWUIvKytUcG9ja2c9IiA+IH4vLnNzaC9rbm93bl9ob3N0cwoKCmVjaG8gIiQoZGF0ZSkgLSBJbnN0YWxsaW5nIE5WSURJQSBEcml2ZXJzIiA+PiAkTE9HRklMRQplY2hvICJzdWRvIGFwdCAteSBpbnN0YWxsIG52aWRpYS1oZWFkbGVzcy01MTUtc2VydmVyIiA+PiAkTE9HRklMRQpzdWRvIGFwdCAteSBpbnN0YWxsIG52aWRpYS1oZWFkbGVzcy01MTUtc2VydmVyCgoK' | base64 -d > /home/ubuntu/reboot-setup/03-reboot.bash
echo 'IyEvYmluL2Jhc2gKCkxPR0ZJTEU9Ii9ob21lL3VidW50dS9zZXR1cC1sb2cudHh0IgplY2hvICJHZXR0aW5nIGN1ZGEta2V5cmluZ18xLjAtMV9hbGwuZGViIiA+PiAkTE9HRklMRQp3Z2V0IGh0dHBzOi8vZGV2ZWxvcGVyLmRvd25sb2FkLm52aWRpYS5jb20vY29tcHV0ZS9jdWRhL3JlcG9zL3VidW50dTIwMDQveDg2XzY0L2N1ZGEta2V5cmluZ18xLjAtMV9hbGwuZGViCnN1ZG8gZHBrZyAtaSBjdWRhLWtleXJpbmdfMS4wLTFfYWxsLmRlYgpzdWRvIGFwdC1rZXkgZGVsIDdmYTJhZjgwCnN1ZG8gYXB0LWdldCB1cGRhdGUKZWNobyAic3VkbyBhcHQtZ2V0IC15IGluc3RhbGwgY3VkYSIgPj4gJExPR0ZJTEUKc3VkbyBhcHQgLXkgaW5zdGFsbCBjdWRhCmVjaG8gJ2V4cG9ydCBQQVRIPS91c3IvbG9jYWwvY3VkYS0xMS44L2JpbiR7UEFUSDorOiR7UEFUSH19JyA+PiAvaG9tZS91YnVudHUvLmJhc2hyYwpzdWRvIGNwIC9saWIvdWRldi9ydWxlcy5kLzQwLXZtLWhvdGFkZC5ydWxlcyAvZXRjL3VkZXYvcnVsZXMuZApzdWRvIHNlZCAtaSAnLyMgTWVtb3J5IGhvdGFkZCByZXF1ZXN0L2QnIC9ldGMvdWRldi9ydWxlcy5kLzQwLXZtLWhvdGFkZC5ydWxlcwpzdWRvIHNlZCAtaSAnL1NVQlNZU1RFTT09Im1lbW9yeSIsIEFDVElPTj09ImFkZCIvZCcgL2V0Yy91ZGV2L3J1bGVzLmQvNDAtdm0taG90YWRkLnJ1bGVzCg==' | base64 -d > /home/ubuntu/reboot-setup/04-reboot.bash
echo 'IyEvYmluL2Jhc2gKCkxPR0ZJTEU9Ii9ob21lL3VidW50dS9zZXR1cC1sb2cudHh0IgplY2hvICJzdWRvIHNuYXAgaW5zdGFsbCBibGVuZGVyIC0tY2xhc3NpYyIgPj4gJExPR0ZJTEUKc3VkbyBzbmFwIGluc3RhbGwgYmxlbmRlciAtLWNsYXNzaWMKCmNkIC9ob21lL3VidW50dQpnaXQgY2xvbmUgaHR0cHM6Ly9naXRodWIuY29tL05WSURJQS9jdWRhLXNhbXBsZXMuZ2l0CmNkIC9ob21lL3VidW50dS9jdWRhLXNhbXBsZXMvU2FtcGxlcy8xX1V0aWxpdGllcy9kZXZpY2VRdWVyeQptYWtlCgpjZCAvaG9tZS91YnVudHUvY3VkYS1zYW1wbGVzL1NhbXBsZXMvMV9VdGlsaXRpZXMvYmFuZHdpZHRoVGVzdAptYWtlCg==' | base64 -d > /home/ubuntu/reboot-setup/05-reboot.bash
echo 'IyEvYmluL2Jhc2gKCkxPR0ZJTEU9Ii9ob21lL3VidW50dS9zZXR1cC1sb2cudHh0IgplY2hvICJzdWRvIHNuYXAgaW5zdGFsbCBibGVuZGVyIC0tY2xhc3NpYyIgPj4gJExPR0ZJTEUKc3VkbyBzbmFwIGluc3RhbGwgYmxlbmRlciAtLWNsYXNzaWMKCmNkIC9ob21lL3VidW50dQpnaXQgY2xvbmUgaHR0cHM6Ly9naXRodWIuY29tL05WSURJQS9jdWRhLXNhbXBsZXMuZ2l0CmNkIC9ob21lL3VidW50dS9jdWRhLXNhbXBsZXMvU2FtcGxlcy8xX1V0aWxpdGllcy9kZXZpY2VRdWVyeQptYWtlCgpjZCAvaG9tZS91YnVudHUvY3VkYS1zYW1wbGVzL1NhbXBsZXMvMV9VdGlsaXRpZXMvYmFuZHdpZHRoVGVzdAptYWtlCg==' | base64 -d > /home/ubuntu/reboot-setup/05-reboot.bash
echo 'IyEvYmluL2Jhc2gKCkxPR0ZJTEU9Ii9ob21lL3VidW50dS9zZXR1cC1sb2cudHh0IgoKZWNobyAiJChkYXRlKSAtIEdldHRpbmcgQ1VEQSBTdGF0cyIgPj4gJExPR0ZJTEUKL2hvbWUvdWJ1bnR1L2N1ZGEtc2FtcGxlcy9TYW1wbGVzLzFfVXRpbGl0aWVzL2RldmljZVF1ZXJ5L2RldmljZVF1ZXJ5ID4gIi9ob21lL3VidW50dS9lYzItYmxlbmRlci1yZW5kZXJlci5hbGFud3NtaXRoLmNvbS9zY3JpcHRzL3Byb2ZpbGVfbWFjaGluZS9zdGF0cy8kKGN1cmwgLXEgaHR0cDovLzE2OS4yNTQuMTY5LjI1NC9sYXRlc3QvbWV0YS1kYXRhL2luc3RhbmNlLXR5cGUpLnR4dCIKCmVjaG8gIiQoZGF0ZSkgLSBHZXR0aW5nIFByb2ZpbGVyIiA+PiAkTE9HRklMRQpnaXQgY2xvbmUgZ2l0QGdpdGh1Yi5jb206YWxhbndzbWl0aC9lYzItYmxlbmRlci1yZW5kZXJlci5hbGFud3NtaXRoLmNvbS5naXQKCgplY2hvICIkKGRhdGUpIC0gUnVubmluZyBQcm9maWxlciIgPj4gJExPR0ZJTEUKY2QgL2hvbWUvdWJ1bnR1L2VjMi1ibGVuZGVyLXJlbmRlcmVyLmFsYW53c21pdGguY29tL3NjcmlwdHMvcHJvZmlsZV9tYWNoaW5lCi91c3IvYmluL3B5dGhvbjMgcHJvZmlsZV9tYWNoaW5lLnB5Cg==' | base64 -d > /home/ubuntu/reboot-setup/06-reboot.bash
reboot
