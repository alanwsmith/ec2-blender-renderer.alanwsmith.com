#!/bin/bash

su ubuntu -c 'echo "Prepping scripts" >> /home/ubuntu/setup-log.txt'

TARGET_DIR="/home/ubuntu/reboot-setup"

su ubuntu -c "mkdir $TARGET_DIR"

su ubuntu -c 'crontab -l > /home/ubuntu/crondata'
echo "@reboot /bin/bash /home/ubuntu/setup-director.bash # REBOOTSETUP" >> /home/ubuntu/crondata
su ubuntu -c 'crontab /home/ubuntu/crondata'
rm /home/ubuntu/crondata
echo 'IyEvYmluL2Jhc2gKCkxPR19GSUxFPSIvaG9tZS91YnVudHUvc2V0dXAtbG9nLnR4dCIKVEFSR0VUX0RJUj0iL2hvbWUvdWJ1bnR1L3JlYm9vdC1zZXR1cCIKQUNUSVZFX0ZJTEU9YGxzICRUQVJHRVRfRElSIHwgc29ydCB8IGhlYWQgLTFgCgplY2hvICIkKGRhdGUpIC0gSW5pdGlhbGl6aW5nIFNldHVwIERpcmVjdG9yIiA+PiAkTE9HX0ZJTEUKCmlmIFsgLXogJEFDVElWRV9GSUxFIF0KdGhlbgogICAgZWNobyAiJChkYXRlKSAtIE5vIG1vcmUgZmlsZXMgdG8gcHJvY2VzcyIgPj4gJExPR19GSUxFCiAgICBlY2hvICIkKGRhdGUpIC0gUmVtb3ZpbmcgZGlyZWN0b3IgcmVtb3ZlZCBmcm9tIGNyb250YWIiID4+ICRMT0dfRklMRQogICAgY3JvbnRhYiAtbCA+IC9ob21lL3VidW50dS9jcm9uZGF0YQogICAgc2VkIC1pICcvUkVCT09UU0VUVVAvZCcgL2hvbWUvdWJ1bnR1L2Nyb25kYXRhCiAgICBjcm9udGFiIC9ob21lL3VidW50dS9jcm9uZGF0YQogICAgcm0gL2hvbWUvdWJ1bnR1L2Nyb25kYXRhCiAgICBlY2hvICIkKGRhdGUpIC0gUmVtb3ZpbmcgJFRBUkdFVF9ESVIiID4+ICRMT0dfRklMRQogICAgcm1kaXIgJFRBUkdFVF9ESVIKICAgIGVjaG8gIiQoZGF0ZSkgLSBSZW1vdmluZyBzZXR1cC1kaXJlY3Rvci5iYXNoIiA+PiAkTE9HX0ZJTEUKICAgIHJtICcvaG9tZS91YnVudHUvc2V0dXAtZGlyZWN0b3IuYmFzaCcKICAgIGVjaG8gIiQoZGF0ZSkgLSBTaHV0dGluZyBkb3duIiA+PiAkTE9HX0ZJTEUKICAgIHN1ZG8gc2h1dGRvd24KZWxzZQogIEFDVElWRV9GSUxFX1BBVEg9IiRUQVJHRVRfRElSLyRBQ1RJVkVfRklMRSIKICBlY2hvICIkKGRhdGUpIC0gUnVubmluZzogJHtBQ1RJVkVfRklMRV9QQVRIfSIgPj4gJExPR19GSUxFCiAgL2Jpbi9iYXNoICRBQ1RJVkVfRklMRV9QQVRICiAgZWNobyAiJChkYXRlKSAtIERlbGV0aW5nOiAke0FDVElWRV9GSUxFX1BBVEh9IiA+PiAkTE9HX0ZJTEUKICBybSAkQUNUSVZFX0ZJTEVfUEFUSAogIGVjaG8gIiQoZGF0ZSkgLSBSZWJvb3RpbmcgZnJvbSBzZXR1cC1kaXJlY3RvciIgPj4gJExPR19GSUxFCiAgc3VkbyByZWJvb3QgCmZpICAgICAgICAgICAK' | base64 -d > /home/ubuntu/setup-director.bash
echo 'IyEvYmluL2Jhc2gKCkxPR0ZJTEU9Ii9ob21lL3VidW50dS9zZXR1cC1sb2cudHh0IgplY2hvICJNYWtpbmcgL3J1bi91c2VyLzEwMDAvZ3ZmcyIgPj4gJExPR0ZJTEUKbWtkaXIgLXAgL3J1bi91c2VyLzEwMDAvZ3ZmcwpjaG1vZCB1Zyt3IC9ydW4vdXNlci8xMDAwL2d2ZnMKZWNobyAic3VkbyBhcHQgLXkgdXBkYXRlIiA+PiAkTE9HRklMRQpzdWRvIGFwdCAteSB1cGRhdGUKZWNobyAic3VkbyBhcHQgLXkgdXBncmFkZSIgPj4gJExPR0ZJTEUKc3VkbyBhcHQgLXkgdXBncmFkZQoK' | base64 -d > /home/ubuntu/reboot-setup/01-reboot.bash
echo 'IyEvYmluL2Jhc2gKCkxPR0ZJTEU9Ii9ob21lL3VidW50dS9zZXR1cC1sb2cudHh0IgoKZWNobyAiJChkYXRlKSAtIHN1ZG8gYXB0IC15IHVwZGF0ZSIgPj4gJExPR0ZJTEUKc3VkbyBhcHQgLXkgdXBkYXRlCgplY2hvICIkKGRhdGUpIC0gSW5zdGFsbGluZyBBV1MgQ0xJIiA+PiAkTE9HRklMRQpzdWRvIHNuYXAgaW5zdGFsbCBhd3MtY2xpIC0tY2xhc3NpYwoKZWNobyAiJChkYXRlKSAtIE1ha2luZyB0ZXN0IGZpbGVzIGRpcmVjdG9yeSIgPj4gJExPR0ZJTEUKbWtkaXIgLXAgL2hvbWUvdWJ1bnR1L2JsZW5kZXJfcHJvZmlsZXIvdGVzdF9maWxlcwoKZWNobyAiJChkYXRlKSAtIEdldHRpbmcgdGVzdCBmaWxlcyBmcm9tIFMzIiA+PiAkTE9HRklMRQovc25hcC9iaW4vYXdzIHMzIGNwICJzMzovL2F3cy10bXAtYmxlbmRlci10ZXN0LWZpbGVzL2ZsYXQtYXJjaGl2aXouYmxlbmQiICIvaG9tZS91YnVudHUvYmxlbmRlcl9wcm9maWxlci90ZXN0X2ZpbGVzL2ZsYXQtYXJjaGl2aXouYmxlbmQiCi9zbmFwL2Jpbi9hd3MgczMgY3AgInMzOi8vYXdzLXRtcC1ibGVuZGVyLXRlc3QtZmlsZXMvbG9mdC5ibGVuZCIgIi9ob21lL3VidW50dS9ibGVuZGVyX3Byb2ZpbGVyL3Rlc3RfZmlsZXMvbG9mdC5ibGVuZCIKL3NuYXAvYmluL2F3cyBzMyBjcCAiczM6Ly9hd3MtdG1wLWJsZW5kZXItdGVzdC1maWxlcy9sb25lLW1vbmtfY3ljbGVzX2FuZF9leHBvc3VyZS1ub2RlX2RlbW8uYmxlbmQiICIvaG9tZS91YnVudHUvYmxlbmRlcl9wcm9maWxlci90ZXN0X2ZpbGVzL2xvbmUtbW9ua19jeWNsZXNfYW5kX2V4cG9zdXJlLW5vZGVfZGVtby5ibGVuZCIKL3NuYXAvYmluL2F3cyBzMyBjcCAiczM6Ly9hd3MtdG1wLWJsZW5kZXItdGVzdC1maWxlcy9tb25zdGVyX3VuZGVyX3RoZV9iZWRfc3NzX2RlbW9fYnlfbWV0aW5fc2V2ZW4uYmxlbmQiICIvaG9tZS91YnVudHUvYmxlbmRlcl9wcm9maWxlci90ZXN0X2ZpbGVzL21vbnN0ZXJfdW5kZXJfdGhlX2JlZF9zc3NfZGVtb19ieV9tZXRpbl9zZXZlbi5ibGVuZCIKCmVjaG8gIiQoZGF0ZSkgLSBJbnN0YWxsaW5nIEJsZW5kZXIgZGVwZW5kaWNpZXMiID4+ICRMT0dGSUxFCnN1ZG8gYXB0IC15IGluc3RhbGwgbGlieGk2CnN1ZG8gYXB0IC15IGluc3RhbGwgbGlieHhmODZ2bS1kZXYKc3VkbyBhcHQgLXkgaW5zdGFsbCBsaWJ4Zml4ZXMtZGV2CnN1ZG8gYXB0IC15IGluc3RhbGwgbGlieHJlbmRlci1kZXYKc3VkbyBhcHQgLXkgaW5zdGFsbCBsaWJnbC1kZXYKCmVjaG8gIiQoZGF0ZSkgLSBJbnN0YWxsaW5nIEdpdCBLZXkiID4+ICRMT0dGSUxFCi9zbmFwL2Jpbi9hd3MgLS1yZWdpb24gdXMtZWFzdC0xIHNlY3JldHNtYW5hZ2VyIGdldC1zZWNyZXQtdmFsdWUgLS1zZWNyZXQtaWQgRUMyX0tleV9Gb3JfR2l0SHViIC0tcXVlcnkgU2VjcmV0U3RyaW5nIC0tb3V0cHV0IHRleHQgPiB+Ly5zc2gvaWRfZWQyNTUxOQpjaG1vZCA0MDAgfi8uc3NoL2lkX2VkMjU1MTkKZXZhbCAiJChzc2gtYWdlbnQgLXMpIiAmJiBzc2gtYWRkIH4vLnNzaC9pZF9lZDI1NTE5CmVjaG8gImdpdGh1Yi5jb20sMTQwLjgyLjExNC4zIGVjZHNhLXNoYTItbmlzdHAyNTYgQUFBQUUyVmpaSE5oTFhOb1lUSXRibWx6ZEhBeU5UWUFBQUFJYm1semRIQXlOVFlBQUFCQkJFbUtTRU5qUUVlek9teGtaTXk3b3BLZ3dGQjlua3Q1WVJyWU1qTnVHNU44N3VSZ2c2Q0xyYm81d0FkVC95NnYwbUtWMFUydzBXWjJZQi8rK1Rwb2NrZz0iID4gfi8uc3NoL2tub3duX2hvc3RzCgoKCg==' | base64 -d > /home/ubuntu/reboot-setup/02-reboot.bash
echo 'IyEvYmluL2Jhc2gKCkxPR0ZJTEU9Ii9ob21lL3VidW50dS9zZXR1cC1sb2cudHh0IgoKCiMgZWNobyAiJChkYXRlKSAtIEluc3RhbGxpbmcgTlZJRElBIERyaXZlcnMiID4+ICRMT0dGSUxFCiMgZWNobyAic3VkbyBhcHQgLXkgaW5zdGFsbCBudmlkaWEtaGVhZGxlc3MtNTE1LXNlcnZlciIgPj4gJExPR0ZJTEUKCiNBZGRpbmcgdGhlc2UgdG8gc2VlIGlmIHRoZXkgd29yayBmb3IgdGhlIFAgc2VyaWVzCgojIGdvdCBhbiBlcnJvciB3aXRoIHRoaXMsIGJ1dCB0aGVuICdudmlkaWEtaGVhZGxlc3MtNTE1LXNlcnZlcicgIGluc3RhbGxlZD8KIyBUT0RPOiBGSWd1cmUgdGhpcyBvdXQKIyBzdWRvIGFwdCAteSBpbnN0YWxsIG52aWRpYS1rZXJuZWwtY29tbW9uLTUxNS1zZXJ2ZXIKCiMgTm90IHN1cmUgaWYgdGhlcmUgd2FzIHNvbWUgREtNUyBzdHVmZiBpbiB0aGVyZSB0b28KCgojIE5vdGUgdGhpcyB3YXMgYWxsIHRoYXQgd2FzIG5lY2Vzc2FyeSBmb3IgdGhlIEcgc2VyaWVzCiMgRHJvcHBpbmcgaXQgZm9yIG5vdyB0byBzZWUgaWYganVzdCBpbnN0YWxsaW5nIGN1ZGEgd29ya3MKIyBzdWRvIGFwdCAteSBpbnN0YWxsIG52aWRpYS1oZWFkbGVzcy01MTUtc2VydmVyCgoKZWNobyAiJChkYXRlKSAtIEluc3RhbGxpbmcgQ3VkYSBLZXlyaW5nIiA+PiAkTE9HRklMRQp3Z2V0IGh0dHBzOi8vZGV2ZWxvcGVyLmRvd25sb2FkLm52aWRpYS5jb20vY29tcHV0ZS9jdWRhL3JlcG9zL3VidW50dTIwMDQveDg2XzY0L2N1ZGEta2V5cmluZ18xLjAtMV9hbGwuZGViCnN1ZG8gZHBrZyAtaSBjdWRhLWtleXJpbmdfMS4wLTFfYWxsLmRlYgpzdWRvIGFwdC1rZXkgZGVsIDdmYTJhZjgwCnN1ZG8gYXB0LWdldCB1cGRhdGUKZWNobyAiJChkYXRlKSAtIEluc3RhbGxpbmcgQ3VkYSIgPj4gJExPR0ZJTEUKc3VkbyBhcHQgLXkgaW5zdGFsbCBjdWRhCgplY2hvICIkKGRhdGUpIC0gRG9pbmcgUG9zdCBJbnN0YWxsIFN0ZXBzIiA+PiAkTE9HRklMRQplY2hvICdleHBvcnQgUEFUSD0vdXNyL2xvY2FsL2N1ZGEtMTEuOC9iaW4ke1BBVEg6Kzoke1BBVEh9fScgPj4gL2hvbWUvdWJ1bnR1Ly5iYXNocmMKc3VkbyBjcCAvbGliL3VkZXYvcnVsZXMuZC80MC12bS1ob3RhZGQucnVsZXMgL2V0Yy91ZGV2L3J1bGVzLmQKc3VkbyBzZWQgLWkgJy8jIE1lbW9yeSBob3RhZGQgcmVxdWVzdC9kJyAvZXRjL3VkZXYvcnVsZXMuZC80MC12bS1ob3RhZGQucnVsZXMKc3VkbyBzZWQgLWkgJy9TVUJTWVNURU09PSJtZW1vcnkiLCBBQ1RJT049PSJhZGQiL2QnIC9ldGMvdWRldi9ydWxlcy5kLzQwLXZtLWhvdGFkZC5ydWxlcwpybSAvaG9tZS91YnVudHUvY3VkYS1rZXlyaW5nXzEuMC0xX2FsbC5kZWIK' | base64 -d > /home/ubuntu/reboot-setup/03-reboot.bash
echo 'IyEvYmluL2Jhc2gKCkxPR0ZJTEU9Ii9ob21lL3VidW50dS9zZXR1cC1sb2cudHh0IgoKZWNobyAiJChkYXRlKSAtIEluc3RhbGxpbmcgQmxlbmRlciIgPj4gJExPR0ZJTEUKc3VkbyBzbmFwIGluc3RhbGwgYmxlbmRlciAtLWNsYXNzaWMKCmVjaG8gIiQoZGF0ZSkgLSBHZXR0aW5nIEN1ZGEgU2FtcGxlcyIgPj4gJExPR0ZJTEUKY2QgL2hvbWUvdWJ1bnR1CmdpdCBjbG9uZSBodHRwczovL2dpdGh1Yi5jb20vTlZJRElBL2N1ZGEtc2FtcGxlcy5naXQKCmVjaG8gIiQoZGF0ZSkgLSBNYWtpbmcgZGV2aWNlUXVlcnkiID4+ICRMT0dGSUxFCmNkIC9ob21lL3VidW50dS9jdWRhLXNhbXBsZXMvU2FtcGxlcy8xX1V0aWxpdGllcy9kZXZpY2VRdWVyeSAmJiBtYWtlCgplY2hvICIkKGRhdGUpIC0gTWFraW5nIGJhbmR3aWR0aFRlc3QiID4+ICRMT0dGSUxFCmNkIC9ob21lL3VidW50dS9jdWRhLXNhbXBsZXMvU2FtcGxlcy8xX1V0aWxpdGllcy9iYW5kd2lkdGhUZXN0ICYmIG1ha2UKCmVjaG8gIiQoZGF0ZSkgLSBHZXR0aW5nIENVREEgU3RhdHMiID4+ICRMT0dGSUxFCi9ob21lL3VidW50dS9jdWRhLXNhbXBsZXMvU2FtcGxlcy8xX1V0aWxpdGllcy9kZXZpY2VRdWVyeS9kZXZpY2VRdWVyeSA+ICIvaG9tZS91YnVudHUvZWMyLWJsZW5kZXItcmVuZGVyZXIuYWxhbndzbWl0aC5jb20vc2NyaXB0cy9wcm9maWxlX21hY2hpbmUvc3RhdHMvJChjdXJsIC1xIGh0dHA6Ly8xNjkuMjU0LjE2OS4yNTQvbGF0ZXN0L21ldGEtZGF0YS9pbnN0YW5jZS10eXBlKS50eHQiCgplY2hvICIkKGRhdGUpIC0gR2V0dGluZyBQcm9maWxlciIgPj4gJExPR0ZJTEUKZ2l0IGNsb25lIGdpdEBnaXRodWIuY29tOmFsYW53c21pdGgvZWMyLWJsZW5kZXItcmVuZGVyZXIuYWxhbndzbWl0aC5jb20uZ2l0CgojIGVjaG8gIiQoZGF0ZSkgLSBSdW5uaW5nIFByb2ZpbGVyIiA+PiAkTE9HRklMRQojIGNkIC9ob21lL3VidW50dS9lYzItYmxlbmRlci1yZW5kZXJlci5hbGFud3NtaXRoLmNvbS9zY3JpcHRzL3Byb2ZpbGVfbWFjaGluZSAmJiAvdXNyL2Jpbi9weXRob24zIHByb2ZpbGVfbWFjaGluZS5weSA=' | base64 -d > /home/ubuntu/reboot-setup/04-reboot.bash
reboot
