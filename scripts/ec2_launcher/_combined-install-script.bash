#!/bin/bash

su ubuntu -c 'echo "Prepping scripts" >> /home/ubuntu/setup-log.txt'

TARGET_DIR="/home/ubuntu/reboot-setup"

su ubuntu -c "mkdir $TARGET_DIR"

su ubuntu -c 'crontab -l > /home/ubuntu/crondata'
echo "@reboot /bin/bash /home/ubuntu/setup-director.bash # REBOOTSETUP" >> /home/ubuntu/crondata
su ubuntu -c 'crontab /home/ubuntu/crondata'
rm /home/ubuntu/crondata
echo 'IyEvYmluL2Jhc2gKCkxPR19GSUxFPSIvaG9tZS91YnVudHUvc2V0dXAtbG9nLnR4dCIKVEFSR0VUX0RJUj0iL2hvbWUvdWJ1bnR1L3JlYm9vdC1zZXR1cCIKQUNUSVZFX0ZJTEU9YGxzICRUQVJHRVRfRElSIHwgc29ydCB8IGhlYWQgLTFgCgplY2hvICIkKGRhdGUpIC0gSW5pdGlhbGl6aW5nIFNldHVwIERpcmVjdG9yIiA+PiAkTE9HX0ZJTEUKCmlmIFsgLXogJEFDVElWRV9GSUxFIF0KdGhlbgogICAgZWNobyAiJChkYXRlKSAtIE5vIG1vcmUgZmlsZXMgdG8gcHJvY2VzcyIgPj4gJExPR19GSUxFCiAgICBlY2hvICIkKGRhdGUpIC0gUmVtb3ZpbmcgZGlyZWN0b3IgcmVtb3ZlZCBmcm9tIGNyb250YWIiID4+ICRMT0dfRklMRQogICAgY3JvbnRhYiAtbCA+IC9ob21lL3VidW50dS9jcm9uZGF0YQogICAgc2VkIC1pICcvUkVCT09UU0VUVVAvZCcgL2hvbWUvdWJ1bnR1L2Nyb25kYXRhCiAgICBjcm9udGFiIC9ob21lL3VidW50dS9jcm9uZGF0YQogICAgcm0gL2hvbWUvdWJ1bnR1L2Nyb25kYXRhCiAgICBlY2hvICIkKGRhdGUpIC0gUmVtb3ZpbmcgJFRBUkdFVF9ESVIiID4+ICRMT0dfRklMRQogICAgcm1kaXIgJFRBUkdFVF9ESVIKICAgIGVjaG8gIiQoZGF0ZSkgLSBSZW1vdmluZyBzZXR1cC1kaXJlY3Rvci5iYXNoIiA+PiAkTE9HX0ZJTEUKICAgIHJtICcvaG9tZS91YnVudHUvc2V0dXAtZGlyZWN0b3IuYmFzaCcKICAgIGVjaG8gIiQoZGF0ZSkgLSBTaHV0dGluZyBkb3duIiA+PiAkTE9HX0ZJTEUKICAgIHN1ZG8gc2h1dGRvd24KZWxzZQogIEFDVElWRV9GSUxFX1BBVEg9IiRUQVJHRVRfRElSLyRBQ1RJVkVfRklMRSIKICBlY2hvICIkKGRhdGUpIC0gUnVubmluZzogJHtBQ1RJVkVfRklMRV9QQVRIfSIgPj4gJExPR19GSUxFCiAgL2Jpbi9iYXNoICRBQ1RJVkVfRklMRV9QQVRICiAgZWNobyAiJChkYXRlKSAtIERlbGV0aW5nOiAke0FDVElWRV9GSUxFX1BBVEh9IiA+PiAkTE9HX0ZJTEUKICBybSAkQUNUSVZFX0ZJTEVfUEFUSAogIGVjaG8gIiQoZGF0ZSkgLSBSZWJvb3RpbmcgZnJvbSBzZXR1cC1kaXJlY3RvciIgPj4gJExPR19GSUxFCiAgc3VkbyByZWJvb3QgCmZpICAgICAgICAgICAK' | base64 -d > /home/ubuntu/setup-director.bash
echo 'IyEvYmluL2Jhc2gKCkxPR0ZJTEU9Ii9ob21lL3VidW50dS9zZXR1cC1sb2cudHh0IgplY2hvICJNYWtpbmcgL3J1bi91c2VyLzEwMDAvZ3ZmcyIgPj4gJExPR0ZJTEUKbWtkaXIgLXAgL3J1bi91c2VyLzEwMDAvZ3ZmcwpjaG1vZCB1Zyt3IC9ydW4vdXNlci8xMDAwL2d2ZnMKZWNobyAic3VkbyBhcHQgLXkgdXBkYXRlIiA+PiAkTE9HRklMRQpzdWRvIGFwdCAteSB1cGRhdGUKZWNobyAic3VkbyBhcHQgLXkgdXBncmFkZSIgPj4gJExPR0ZJTEUKc3VkbyBhcHQgLXkgdXBncmFkZQoK' | base64 -d > /home/ubuntu/reboot-setup/01-reboot.bash
echo 'IyEvYmluL2Jhc2gKCkxPR0ZJTEU9Ii9ob21lL3VidW50dS9zZXR1cC1sb2cudHh0IgplY2hvICJzdWRvIGFwdCAteSB1cGRhdGUiID4+ICRMT0dGSUxFCnN1ZG8gYXB0IC15IHVwZGF0ZQplY2hvICJNYWtpbmcgdGVzdCBmaWxlcyBkaXJlY3RvcnkiID4+ICRMT0dGSUxFCm1rZGlyIC1wIC9ob21lL3VidW50dS9ibGVuZGVyX3Byb2ZpbGVyL3Rlc3RfZmlsZXMKZWNobyAiSW5zdGFsbGluZyBBV1MgQ0xJIiA+PiAkTE9HRklMRQpzdWRvIHNuYXAgaW5zdGFsbCBhd3MtY2xpIC0tY2xhc3NpYwoKCmVjaG8gIkluc3RhbGxpbmcgQmxlbmRlciBkZXBlbmRpY2llcyIgPj4gJExPR0ZJTEUKc3VkbyBhcHQgLXkgaW5zdGFsbCBsaWJ4aTYKc3VkbyBhcHQgLXkgaW5zdGFsbCBsaWJ4eGY4NnZtLWRldgpzdWRvIGFwdCAteSBpbnN0YWxsIGxpYnhmaXhlcy1kZXYKc3VkbyBhcHQgLXkgaW5zdGFsbCBsaWJ4cmVuZGVyLWRldgpzdWRvIGFwdCAteSBpbnN0YWxsIGxpYmdsLWRldgo=' | base64 -d > /home/ubuntu/reboot-setup/02-reboot.bash
echo 'IyEvYmluL2Jhc2gKCkxPR0ZJTEU9Ii9ob21lL3VidW50dS9zZXR1cC1sb2cudHh0IgoKZWNobyAiJChkYXRlKSAtIEdldHRpbmcgZmlsZXMgZnJvbSBTMyIgPj4gJExPR0ZJTEUKYXdzIHMzIGNwICJzMzovL2F3cy10bXAtYmxlbmRlci10ZXN0LWZpbGVzL2ZsYXQtYXJjaGl2aXouYmxlbmQiICIvaG9tZS91YnVudHUvYmxlbmRlcl9wcm9maWxlci90ZXN0X2ZpbGVzL2ZsYXQtYXJjaGl2aXouYmxlbmQiCmF3cyBzMyBjcCAiczM6Ly9hd3MtdG1wLWJsZW5kZXItdGVzdC1maWxlcy9sb2Z0LmJsZW5kIiAiL2hvbWUvdWJ1bnR1L2JsZW5kZXJfcHJvZmlsZXIvdGVzdF9maWxlcy9sb2Z0LmJsZW5kIgphd3MgczMgY3AgInMzOi8vYXdzLXRtcC1ibGVuZGVyLXRlc3QtZmlsZXMvbG9uZS1tb25rX2N5Y2xlc19hbmRfZXhwb3N1cmUtbm9kZV9kZW1vLmJsZW5kIiAiL2hvbWUvdWJ1bnR1L2JsZW5kZXJfcHJvZmlsZXIvdGVzdF9maWxlcy9sb25lLW1vbmtfY3ljbGVzX2FuZF9leHBvc3VyZS1ub2RlX2RlbW8uYmxlbmQiCmF3cyBzMyBjcCAiczM6Ly9hd3MtdG1wLWJsZW5kZXItdGVzdC1maWxlcy9tb25zdGVyX3VuZGVyX3RoZV9iZWRfc3NzX2RlbW9fYnlfbWV0aW5fc2V2ZW4uYmxlbmQiICIvaG9tZS91YnVudHUvYmxlbmRlcl9wcm9maWxlci90ZXN0X2ZpbGVzL21vbnN0ZXJfdW5kZXJfdGhlX2JlZF9zc3NfZGVtb19ieV9tZXRpbl9zZXZlbi5ibGVuZCIKCmVjaG8gIiQoZGF0ZSkgLSBHZXR0aW5nIGdpdCBrZXkiID4+ICRMT0dGSUxFCmF3cyAtLXJlZ2lvbiB1cy1lYXN0LTEgc2VjcmV0c21hbmFnZXIgZ2V0LXNlY3JldC12YWx1ZSAtLXNlY3JldC1pZCBFQzJfS2V5X0Zvcl9HaXRIdWIgLS1xdWVyeSBTZWNyZXRTdHJpbmcgLS1vdXRwdXQgdGV4dCA+IH4vLnNzaC9pZF9lZDI1NTE5CmNobW9kIDQwMCB+Ly5zc2gvaWRfZWQyNTUxOQpldmFsICIkKHNzaC1hZ2VudCAtcykiICYmIHNzaC1hZGQgfi8uc3NoL2lkX2VkMjU1MTkKZWNobyAiZ2l0aHViLmNvbSwxNDAuODIuMTE0LjMgZWNkc2Etc2hhMi1uaXN0cDI1NiBBQUFBRTJWalpITmhMWE5vWVRJdGJtbHpkSEF5TlRZQUFBQUlibWx6ZEhBeU5UWUFBQUJCQkVtS1NFTmpRRWV6T214a1pNeTdvcEtnd0ZCOW5rdDVZUnJZTWpOdUc1Tjg3dVJnZzZDTHJibzV3QWRUL3k2djBtS1YwVTJ3MFdaMllCLysrVHBvY2tnPSIgPiB+Ly5zc2gva25vd25faG9zdHMKCgplY2hvICIkKGRhdGUpIC0gSW5zdGFsbGluZyBOVklESUEgRHJpdmVycyIgPj4gJExPR0ZJTEUKZWNobyAic3VkbyBhcHQgLXkgaW5zdGFsbCBudmlkaWEtaGVhZGxlc3MtNTE1LXNlcnZlciIgPj4gJExPR0ZJTEUKc3VkbyBhcHQgLXkgaW5zdGFsbCBudmlkaWEtaGVhZGxlc3MtNTE1LXNlcnZlcgoKCg==' | base64 -d > /home/ubuntu/reboot-setup/03-reboot.bash
echo 'IyEvYmluL2Jhc2gKCkxPR0ZJTEU9Ii9ob21lL3VidW50dS9zZXR1cC1sb2cudHh0IgplY2hvICJHZXR0aW5nIGN1ZGEta2V5cmluZ18xLjAtMV9hbGwuZGViIiA+PiAkTE9HRklMRQp3Z2V0IGh0dHBzOi8vZGV2ZWxvcGVyLmRvd25sb2FkLm52aWRpYS5jb20vY29tcHV0ZS9jdWRhL3JlcG9zL3VidW50dTIwMDQveDg2XzY0L2N1ZGEta2V5cmluZ18xLjAtMV9hbGwuZGViCnN1ZG8gZHBrZyAtaSBjdWRhLWtleXJpbmdfMS4wLTFfYWxsLmRlYgpzdWRvIGFwdC1rZXkgZGVsIDdmYTJhZjgwCnN1ZG8gYXB0LWdldCB1cGRhdGUKZWNobyAic3VkbyBhcHQtZ2V0IC15IGluc3RhbGwgY3VkYSIgPj4gJExPR0ZJTEUKc3VkbyBhcHQgLXkgaW5zdGFsbCBjdWRhCmVjaG8gJ2V4cG9ydCBQQVRIPS91c3IvbG9jYWwvY3VkYS0xMS44L2JpbiR7UEFUSDorOiR7UEFUSH19JyA+PiAvaG9tZS91YnVudHUvLmJhc2hyYwpzdWRvIGNwIC9saWIvdWRldi9ydWxlcy5kLzQwLXZtLWhvdGFkZC5ydWxlcyAvZXRjL3VkZXYvcnVsZXMuZApzdWRvIHNlZCAtaSAnLyMgTWVtb3J5IGhvdGFkZCByZXF1ZXN0L2QnIC9ldGMvdWRldi9ydWxlcy5kLzQwLXZtLWhvdGFkZC5ydWxlcwpzdWRvIHNlZCAtaSAnL1NVQlNZU1RFTT09Im1lbW9yeSIsIEFDVElPTj09ImFkZCIvZCcgL2V0Yy91ZGV2L3J1bGVzLmQvNDAtdm0taG90YWRkLnJ1bGVzCg==' | base64 -d > /home/ubuntu/reboot-setup/04-reboot.bash
echo 'IyEvYmluL2Jhc2gKCkxPR0ZJTEU9Ii9ob21lL3VidW50dS9zZXR1cC1sb2cudHh0IgplY2hvICJzdWRvIHNuYXAgaW5zdGFsbCBibGVuZGVyIC0tY2xhc3NpYyIgPj4gJExPR0ZJTEUKc3VkbyBzbmFwIGluc3RhbGwgYmxlbmRlciAtLWNsYXNzaWMKCmNkIC9ob21lL3VidW50dQpnaXQgY2xvbmUgaHR0cHM6Ly9naXRodWIuY29tL05WSURJQS9jdWRhLXNhbXBsZXMuZ2l0CmNkIC9ob21lL3VidW50dS9jdWRhLXNhbXBsZXMvU2FtcGxlcy8xX1V0aWxpdGllcy9kZXZpY2VRdWVyeQptYWtlCgpjZCAvaG9tZS91YnVudHUvY3VkYS1zYW1wbGVzL1NhbXBsZXMvMV9VdGlsaXRpZXMvYmFuZHdpZHRoVGVzdAptYWtlCgpjZCAvaG9tZS91YnVudHUK' | base64 -d > /home/ubuntu/reboot-setup/05-reboot.bash
echo 'IyEvYmluL2Jhc2gKCkxPR0ZJTEU9Ii9ob21lL3VidW50dS9zZXR1cC1sb2cudHh0IgplY2hvICJzdWRvIHNuYXAgaW5zdGFsbCBibGVuZGVyIC0tY2xhc3NpYyIgPj4gJExPR0ZJTEUKc3VkbyBzbmFwIGluc3RhbGwgYmxlbmRlciAtLWNsYXNzaWMKCmNkIC9ob21lL3VidW50dQpnaXQgY2xvbmUgaHR0cHM6Ly9naXRodWIuY29tL05WSURJQS9jdWRhLXNhbXBsZXMuZ2l0CmNkIC9ob21lL3VidW50dS9jdWRhLXNhbXBsZXMvU2FtcGxlcy8xX1V0aWxpdGllcy9kZXZpY2VRdWVyeQptYWtlCgpjZCAvaG9tZS91YnVudHUvY3VkYS1zYW1wbGVzL1NhbXBsZXMvMV9VdGlsaXRpZXMvYmFuZHdpZHRoVGVzdAptYWtlCgpjZCAvaG9tZS91YnVudHUK' | base64 -d > /home/ubuntu/reboot-setup/05-reboot.bash
echo 'IyEvYmluL2Jhc2gKCkxPR0ZJTEU9Ii9ob21lL3VidW50dS9zZXR1cC1sb2cudHh0IgplY2hvICIkKGRhdGUpIC0gR2V0dGluZyBQcm9maWxlciIgPj4gJExPR0ZJTEUKZ2l0IGNsb25lIGdpdEBnaXRodWIuY29tOmFsYW53c21pdGgvZWMyLWJsZW5kZXItcmVuZGVyZXIuYWxhbndzbWl0aC5jb20uZ2l0CmVjaG8gIiQoZGF0ZSkgLSBSdW5uaW5nIFByb2ZpbGVyIiA+PiAkTE9HRklMRQpjZCAvaG9tZS91YnVudHUvZWMyLWJsZW5kZXItcmVuZGVyZXIuYWxhbndzbWl0aC5jb20vc2NyaXB0cy9wcm9maWxlX21hY2hpbmUKcHl0aG9uMyBwcm9maWxlX21hY2hpbmUucHkK' | base64 -d > /home/ubuntu/reboot-setup/06-reboot.bash
reboot
