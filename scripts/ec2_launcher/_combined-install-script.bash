#!/bin/bash

su ubuntu -c "mkdir -p /home/ubuntu/setup/steps"
su ubuntu -c 'echo "$(date) - Initial boot" >> /home/ubuntu/setup/log.txt'

su ubuntu -c 'crontab -l > /home/ubuntu/setup/crondata'
echo "@reboot /bin/bash /home/ubuntu/setup/director.bash # REBOOTSETUP" >> /home/ubuntu/setup/crondata
su ubuntu -c 'crontab /home/ubuntu/setup/crondata'
rm /home/ubuntu/setup/crondata
echo 'IyEvYmluL2Jhc2gKCkxPR19GSUxFPSIvaG9tZS91YnVudHUvc2V0dXAvbG9nLnR4dCIKVEFSR0VUX0RJUj0iL2hvbWUvdWJ1bnR1L3NldHVwL3N0ZXBzIgpBQ1RJVkVfRklMRT1gbHMgJFRBUkdFVF9ESVIgfCBzb3J0IHwgaGVhZCAtMWAKCmVjaG8gIiQoZGF0ZSkgLSBJbml0aWFsaXppbmcgU2V0dXAgRGlyZWN0b3IiID4+ICRMT0dfRklMRQoKaWYgWyAteiAkQUNUSVZFX0ZJTEUgXQp0aGVuCiAgICBlY2hvICIkKGRhdGUpIC0gTm8gbW9yZSBmaWxlcyB0byBwcm9jZXNzIiA+PiAkTE9HX0ZJTEUKICAgIGVjaG8gIiQoZGF0ZSkgLSBSZW1vdmluZyBkaXJlY3RvciByZW1vdmVkIGZyb20gY3JvbnRhYiIgPj4gJExPR19GSUxFCiAgICBjcm9udGFiIC1sID4gL2hvbWUvdWJ1bnR1L2Nyb25kYXRhCiAgICBzZWQgLWkgJy9SRUJPT1RTRVRVUC9kJyAvaG9tZS91YnVudHUvY3JvbmRhdGEKICAgIGNyb250YWIgL2hvbWUvdWJ1bnR1L2Nyb25kYXRhCiAgICBybSAvaG9tZS91YnVudHUvY3JvbmRhdGEKICAgIGVjaG8gIiQoZGF0ZSkgLSBSZW1vdmluZyAkVEFSR0VUX0RJUiIgPj4gJExPR19GSUxFCiAgICBybWRpciAkVEFSR0VUX0RJUgogICAgZWNobyAiJChkYXRlKSAtIFJlbW92aW5nIHNldHVwLWRpcmVjdG9yLmJhc2giID4+ICRMT0dfRklMRQogICAgcm0gJy9ob21lL3VidW50dS9zZXR1cC1kaXJlY3Rvci5iYXNoJwogICAgZWNobyAiJChkYXRlKSAtIFNFVFVQIFBST0NFU1MgQ09NUExFVEUiID4+ICRMT0dfRklMRQogICAgZWNobyAiJChkYXRlKSAtIFNodXR0aW5nIGRvd24iID4+ICRMT0dfRklMRQogICAgc3VkbyBzaHV0ZG93bgplbHNlCiAgQUNUSVZFX0ZJTEVfUEFUSD0iJFRBUkdFVF9ESVIvJEFDVElWRV9GSUxFIgogIGVjaG8gIiQoZGF0ZSkgLSBSdW5uaW5nOiAke0FDVElWRV9GSUxFX1BBVEh9IiA+PiAkTE9HX0ZJTEUKICAvYmluL2Jhc2ggJEFDVElWRV9GSUxFX1BBVEgKICBlY2hvICIkKGRhdGUpIC0gRGVsZXRpbmc6ICR7QUNUSVZFX0ZJTEVfUEFUSH0iID4+ICRMT0dfRklMRQogIHJtICRBQ1RJVkVfRklMRV9QQVRICiAgZWNobyAiJChkYXRlKSAtIFJlYm9vdGluZyBmcm9tIHNldHVwLWRpcmVjdG9yIiA+PiAkTE9HX0ZJTEUKICBzdWRvIHJlYm9vdCAKZmkgICAgICAgICAgIAo=' | base64 -d > /home/ubuntu/setup/director.bash
echo 'IyEvYmluL2Jhc2gKCkxPR0ZJTEU9Ii9ob21lL3VidW50dS9zZXR1cC9sb2cudHh0IgplY2hvICIkKGRhdGUpIC0gUnVubmluZzogYXB0IC15IHVwZGF0ZSIgPj4gJExPR0ZJTEUKc3VkbyBhcHQgLXkgdXBkYXRlCmVjaG8gIiQoZGF0ZSkgLSBSdW5uaW5nOiBzdWRvIGFwdCAteSB1cGdyYWRlIiA+PiAkTE9HRklMRQpzdWRvIGFwdCAteSB1cGdyYWRlCg==' | base64 -d > /home/ubuntu/setup/steps/01.bash
echo 'IyEvYmluL2Jhc2gKCkxPR0ZJTEU9Ii9ob21lL3VidW50dS9zZXR1cC9sb2cudHh0IgoKZWNobyAiJChkYXRlKSAtIHN1ZG8gYXB0IC15IHVwZGF0ZSIgPj4gJExPR0ZJTEUKc3VkbyBhcHQgLXkgdXBkYXRlCgplY2hvICIkKGRhdGUpIC0gSW5zdGFsbGluZyBBV1MgQ0xJIiA+PiAkTE9HRklMRQpzdWRvIHNuYXAgaW5zdGFsbCBhd3MtY2xpIC0tY2xhc3NpYwoKZWNobyAiJChkYXRlKSAtIE1ha2luZyB0ZXN0IGZpbGVzIGRpcmVjdG9yeSIgPj4gJExPR0ZJTEUKbWtkaXIgLXAgL2hvbWUvdWJ1bnR1L2JsZW5kZXJfcHJvZmlsZXIvdGVzdF9maWxlcwoKZWNobyAiJChkYXRlKSAtIEdldHRpbmcgdGVzdCBmaWxlcyBmcm9tIFMzIiA+PiAkTE9HRklMRQovc25hcC9iaW4vYXdzIHMzIGNwICJzMzovL2F3cy10bXAtYmxlbmRlci10ZXN0LWZpbGVzL2ZsYXQtYXJjaGl2aXouYmxlbmQiICIvaG9tZS91YnVudHUvYmxlbmRlcl9wcm9maWxlci90ZXN0X2ZpbGVzL2ZsYXQtYXJjaGl2aXouYmxlbmQiCi9zbmFwL2Jpbi9hd3MgczMgY3AgInMzOi8vYXdzLXRtcC1ibGVuZGVyLXRlc3QtZmlsZXMvbG9mdC5ibGVuZCIgIi9ob21lL3VidW50dS9ibGVuZGVyX3Byb2ZpbGVyL3Rlc3RfZmlsZXMvbG9mdC5ibGVuZCIKL3NuYXAvYmluL2F3cyBzMyBjcCAiczM6Ly9hd3MtdG1wLWJsZW5kZXItdGVzdC1maWxlcy9sb25lLW1vbmtfY3ljbGVzX2FuZF9leHBvc3VyZS1ub2RlX2RlbW8uYmxlbmQiICIvaG9tZS91YnVudHUvYmxlbmRlcl9wcm9maWxlci90ZXN0X2ZpbGVzL2xvbmUtbW9ua19jeWNsZXNfYW5kX2V4cG9zdXJlLW5vZGVfZGVtby5ibGVuZCIKL3NuYXAvYmluL2F3cyBzMyBjcCAiczM6Ly9hd3MtdG1wLWJsZW5kZXItdGVzdC1maWxlcy9tb25zdGVyX3VuZGVyX3RoZV9iZWRfc3NzX2RlbW9fYnlfbWV0aW5fc2V2ZW4uYmxlbmQiICIvaG9tZS91YnVudHUvYmxlbmRlcl9wcm9maWxlci90ZXN0X2ZpbGVzL21vbnN0ZXJfdW5kZXJfdGhlX2JlZF9zc3NfZGVtb19ieV9tZXRpbl9zZXZlbi5ibGVuZCIKCmVjaG8gIiQoZGF0ZSkgLSBJbnN0YWxsaW5nIEJsZW5kZXIgZGVwZW5kaWNpZXMiID4+ICRMT0dGSUxFCnN1ZG8gYXB0IC15IGluc3RhbGwgbGlieGk2CnN1ZG8gYXB0IC15IGluc3RhbGwgbGlieHhmODZ2bS1kZXYKc3VkbyBhcHQgLXkgaW5zdGFsbCBsaWJ4Zml4ZXMtZGV2CnN1ZG8gYXB0IC15IGluc3RhbGwgbGlieHJlbmRlci1kZXYKc3VkbyBhcHQgLXkgaW5zdGFsbCBsaWJnbC1kZXYKCmVjaG8gIiQoZGF0ZSkgLSBJbnN0YWxsaW5nIEdpdCBLZXkiID4+ICRMT0dGSUxFCi9zbmFwL2Jpbi9hd3MgLS1yZWdpb24gdXMtZWFzdC0xIHNlY3JldHNtYW5hZ2VyIGdldC1zZWNyZXQtdmFsdWUgLS1zZWNyZXQtaWQgRUMyX0tleV9Gb3JfR2l0SHViIC0tcXVlcnkgU2VjcmV0U3RyaW5nIC0tb3V0cHV0IHRleHQgPiB+Ly5zc2gvaWRfZWQyNTUxOQpjaG1vZCA0MDAgfi8uc3NoL2lkX2VkMjU1MTkKZXZhbCAiJChzc2gtYWdlbnQgLXMpIiAmJiBzc2gtYWRkIH4vLnNzaC9pZF9lZDI1NTE5CmVjaG8gImdpdGh1Yi5jb20sMTQwLjgyLjExNC4zIGVjZHNhLXNoYTItbmlzdHAyNTYgQUFBQUUyVmpaSE5oTFhOb1lUSXRibWx6ZEhBeU5UWUFBQUFJYm1semRIQXlOVFlBQUFCQkJFbUtTRU5qUUVlek9teGtaTXk3b3BLZ3dGQjlua3Q1WVJyWU1qTnVHNU44N3VSZ2c2Q0xyYm81d0FkVC95NnYwbUtWMFUydzBXWjJZQi8rK1Rwb2NrZz0iID4gfi8uc3NoL2tub3duX2hvc3RzCgo=' | base64 -d > /home/ubuntu/setup/steps/02.bash
reboot
